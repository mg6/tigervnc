From 4207d0d5cf2330a39830dbc5971f1c199e86e0a2 Mon Sep 17 00:00:00 2001
From: Joachim Falk <joachim.falk@gmx.de>
Date: Thu, 13 Oct 2011 19:57:53 +0200
Subject: [PATCH 5/7] Added RH patch tigervnc11-rh690245.patch which add TLS encryption to VeNCrypt

TigerVNC (Xvnc, x0vncserver, the libvnc.so module, and vncviewer) now
supports TLS encryption (using VeNCrypt) which allows TLS encrypted
communication between a server and a viewer. (BZ#653491)
---
 common/rfb/Security.cxx       |    3 ---
 common/rfb/SecurityClient.cxx |    2 +-
 common/rfb/SecurityServer.cxx |    2 +-
 3 files changed, 2 insertions(+), 5 deletions(-)

diff --git a/common/rfb/Security.cxx b/common/rfb/Security.cxx
index e51c891..dba14fd 100644
--- a/common/rfb/Security.cxx
+++ b/common/rfb/Security.cxx
@@ -67,7 +67,6 @@ const std::list<rdr::U8> Security::GetEnabledSecTypes(void)
   list<rdr::U8> result;
   list<U32>::iterator i;
 
-  result.push_back(secTypeVeNCrypt);
   for (i = enabledSecTypes.begin(); i != enabledSecTypes.end(); i++)
     if (*i < 0x100)
       result.push_back(*i);
@@ -105,8 +104,6 @@ bool Security::IsSupported(U32 secType)
   for (i = enabledSecTypes.begin(); i != enabledSecTypes.end(); i++)
     if (*i == secType)
       return true;
-  if (secType == secTypeVeNCrypt)
-    return true;
 
   return false;
 }
diff --git a/common/rfb/SecurityClient.cxx b/common/rfb/SecurityClient.cxx
index 4173c74..0b69298 100644
--- a/common/rfb/SecurityClient.cxx
+++ b/common/rfb/SecurityClient.cxx
@@ -45,7 +45,7 @@ StringParameter SecurityClient::secTypes
 ("SecurityTypes",
  "Specify which security scheme to use (None, VncAuth)",
 #ifdef HAVE_GNUTLS
- "X509Plain,TLSPlain,X509Vnc,TLSVnc,X509None,TLSNone,VncAuth,None",
+ "VeNCrypt,X509Plain,TLSPlain,X509Vnc,TLSVnc,X509None,TLSNone,VncAuth,None",
 #else
  "VncAuth,None",
 #endif
diff --git a/common/rfb/SecurityServer.cxx b/common/rfb/SecurityServer.cxx
index 76ece77..66f9f91 100644
--- a/common/rfb/SecurityServer.cxx
+++ b/common/rfb/SecurityServer.cxx
@@ -39,7 +39,7 @@ StringParameter SecurityServer::secTypes
 ("SecurityTypes",
  "Specify which security scheme to use (None, VncAuth)",
 #ifdef HAVE_GNUTLS
- "VncAuth,TLSVnc",
+ "VncAuth",
 #else
  "VncAuth",
 #endif
-- 
1.7.2.5

