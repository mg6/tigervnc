From dfcee5fe0799a0b05c82df5101ee37e221502ac9 Mon Sep 17 00:00:00 2001
From: Joachim Falk <joachim.falk@gmx.de>
Date: Thu, 13 Oct 2011 19:53:42 +0200
Subject: [PATCH 4/7] Added RH patch tigervnc11-rh588342.patch which fixes EQ overflowing bug.

Xvnc could become unresponsive and the following error message was shown
in the log: "[mi] EQ overflowing. The server is probably stuck in an
infinite loop.". This was caused by a large number of user input events
in the Xvnc event queue, which were being processed too slowly. With
this update, this issue no longer occurs and the system works as
expected. (BZ#588342)
---
 unix/xserver/hw/vnc/Input.cc |    7 +++++++
 1 files changed, 7 insertions(+), 0 deletions(-)

diff --git a/unix/xserver/hw/vnc/Input.cc b/unix/xserver/hw/vnc/Input.cc
index f36244a..a905ceb 100644
--- a/unix/xserver/hw/vnc/Input.cc
+++ b/unix/xserver/hw/vnc/Input.cc
@@ -153,6 +153,9 @@ void InputDevice::PointerButtonAction(int buttonMask)
 
 	initInputDevice();
 
+	/* Flush event queue to ensure we don't flood it */
+	mieqProcessInputEvents();
+
 	for (i = 0; i < BUTTONS; i++) {
 		if ((buttonMask ^ oldButtonMask) & (1 << i)) {
 			int action = (buttonMask & (1<<i)) ?
@@ -195,6 +198,10 @@ void InputDevice::PointerMove(const rfb::Point &pos)
 	n = GetPointerEvents(eventq, pointerDev, MotionNotify, 0, POINTER_ABSOLUTE,
 			     &mask);
 #endif
+
+	/* Flush event queue to ensure we don't flood it */
+	mieqProcessInputEvents();
+
 	enqueueEvents(pointerDev, n);
 
 	cursorPos = pos;
-- 
1.7.2.5

